# 更新日志 / Changelog

## [未发布] - 2025-01-XX

### 新增 ✨

#### 文件格式支持
- 新增 **70+ 种**文件格式支持，总计支持 **220+ 种**格式
- **图片格式** (新增 10 种):
  - `dng` - DNG RAW 图片（Adobe Digital Negative）
  - `avif` - AVIF 图片
  - `jxl` - JPEG XL 图片
  - `cr2`, `cr3` - Canon RAW 图片
  - `nef` - Nikon RAW 图片
  - `arw` - Sony RAW 图片
  - `orf` - Olympus RAW 图片
  - `rw2` - Panasonic RAW 图片
  - `exr` - OpenEXR 图片
- **视频格式** (新增 5 种):
  - `m4v` - M4V 视频
  - `vob` - DVD 视频
  - `ts` - 传输流视频
  - `f4v` - Flash 视频
  - `ogv` - Ogg 视频
- **音频格式** (新增 4 种):
  - `opus` - Opus 音频
  - `ape` - APE 无损音频
  - `alac` - Apple 无损音频
  - `dsd` - DSD 音频
- **新类别 - 3D 模型** (15 种格式):
  - `blend` - Blender 文件
  - `fbx` - FBX 模型
  - `obj` - Wavefront OBJ
  - `stl` - STL 3D 打印
  - `dae` - COLLADA 模型
  - `gltf`, `glb` - glTF 模型
  - `3ds` - 3DS Max 模型
  - `max` - 3DS Max 场景
  - `c4d` - Cinema 4D 文件
  - `ma`, `mb` - Maya 文件
  - `skp` - SketchUp 模型
  - `dwg`, `dxf` - AutoCAD 文件
- **新类别 - 字体文件** (7 种格式):
  - `ttf` - TrueType 字体
  - `otf` - OpenType 字体
  - `woff`, `woff2` - Web 字体
  - `eot` - Embedded OpenType
  - `fon` - 位图字体
  - `dfont` - Mac 字体
- **虚拟机与镜像** (5 种格式):
  - `vmdk` - VMware 磁盘
  - `vdi` - VirtualBox 磁盘
  - `qcow2` - QEMU 磁盘
  - `ova`, `ovf` - 虚拟机格式
- **其他格式**:
  - `kdbx` - KeePass 数据库
- **音乐记谱**：
  - `sib` - Sibelius 记谱文件
- **压缩文件**：
  - `mxl` - MusicXML 压缩文件
- **脚本与配置**：
  - `cmd` - Windows CMD 批处理脚本
  - `ps1` - PowerShell 脚本
  - `vbs` - VBScript 脚本
  - `bash` - Bash 脚本
  - `zsh` - Zsh 脚本
  - `lua` - Lua 脚本
  - `r` - R 语言脚本
  - `m` - MATLAB 脚本
  - `dockerfile` - Docker 配置文件
  - `makefile` - Make 配置文件
  - `gradle` - Gradle 配置文件
  - `toml` - TOML 配置文件
  - `properties` - Properties 配置文件
- **新类别 - 数据库** (6 种格式):
  - `db` - 通用数据库文件
  - `sqlite` - SQLite 数据库
  - `sqlite3` - SQLite3 数据库
  - `db3` - SQLite3 数据库
  - `mdb` - Access 数据库
  - `accdb` - Access 数据库
- **新类别 - 证书 & 密钥** (8 种格式):
  - `pem` - PEM 证书
  - `key` - 密钥文件
  - `crt` - 证书文件
  - `cer` - 证书文件
  - `p12` - PKCS12 证书
  - `pfx` - PFX 证书
  - `license` - 许可证文件
  - `lic` - 许可证文件
- **系统文件**：
  - `command` - macOS 命令文件
  - `reg` - Windows 注册表文件
- **其他格式**：
  - `vcf` - 联系人文件
  - `midi` - MIDI 音频文件

#### 功能增强
- **🚀 分块处理机制**：实现智能分块文件处理，支持高达 2 GB 的大文件
  - 对于 > 256 MB 的文件自动启用分块处理模式
  - 每块 256 MB，共8块（2GB）
  - 实时显示处理进度（百分比和块数）
  - 性能优化：大预算使用区间破坏，避免数亿次迭代
  - 小文件继续使用精细策略，大文件使用高效分块策略
  - **限制说明**：由于浏览器内存限制，所有块在最终Blob创建前仍需保持在内存中
- **可复现的随机数生成器**：实现了基于种子的伪随机数生成器（LCG算法），确保使用相同种子可以完全复现破坏过程
- **文件大小限制提升**：从 200 MB 提升至 2 GB，平衡性能和内存使用
- **更健壮的扩展名提取**：改进文件扩展名提取逻辑，正确处理边缘情况（无扩展名、多个点、隐藏文件等）
- **浏览器兼容性检查**：启动时自动检测必需的 API 支持（File API、ArrayBuffer、Blob 等）

### 改进 🔧

#### 代码质量
- **修复随机位置破坏的重复问题**：使用 Set 数据结构确保不会重复修改同一位置，统计更准确
- **改进签名嵌入逻辑**：
  - 小文件跳过签名嵌入
  - 媒体和二进制文件在安全位置嵌入签名，避免破坏关键头部
  - 使用上下文提供的随机数生成器
- **概率值边界检查**：所有概率参数进行 [0, 1] 范围限制
- **统一随机数源**：所有破坏函数使用上下文传递的随机数生成器，确保可复现性

#### 错误处理
- **增强的错误提示**：
  - 文件过大：显示当前文件大小和限制
  - 无扩展名：友好提示用户检查文件名
  - 内存不足：识别 QuotaExceededError 并提供有用建议
  - 类型错误：提示文件可能损坏
- **输入清理**：错误发生后自动清理文件输入，避免重复选择同一文件时出现问题
- **状态恢复**：破坏失败时恢复到选项界面，而不是重置整个应用

#### 性能优化
- **缩短等待时间**：将模拟延迟从 1000ms 降至 800ms，提升响应速度
- **边界安全检查**：所有数组操作都进行边界检查，防止越界访问

### 修复 🐛

- 修复：文件输入监听器中的无意义 `{ once: false }` 选项
- 修复：概率值可能超出 [0, 1] 范围导致的不正确行为
- 修复：`randomizeRandomPositions` 可能多次修改同一位置但统计不准的问题
- 修复：扩展名提取对 `.hidden`、`noextension`、`file.` 等边缘情况处理不当
- 修复：浏览器兼容性检查在 Node.js 环境中导致错误
- 修复：大文件可能导致浏览器崩溃的风险

### 文档 📚

- 更新 README：反映新增的 50+ 种文件格式
- 添加文件大小限制说明
- 添加可复现破坏功能的说明
- 更新功能特点：从 100+ 更新为 150+ 种格式
- 添加固定随机种子的高级选项说明

---

## [1.0.0] - 2025-01-初版

### 初始发布
- 支持 100+ 种常见文件格式
- 轻度/中度/重度三种破坏级别
- 完全本地处理，保护隐私
- Apple 风格的极简界面
- 拖拽上传支持
- 破坏报告生成
- 高级选项：随机文件名、签名嵌入、报告导出
